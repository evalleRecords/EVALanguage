<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Estonian TTS Demo</title>
<style>
  body { font-family: sans-serif; padding: 1rem; max-width: 600px; margin: auto; }
  textarea { width: 100%; height: 120px; }
  button { margin-top: 1rem; }
  audio { display: block; margin-top: 1rem; width: 100%; }
</style>
</head>
<body>
<h1>Estonian Text-to-Speech</h1>

<label for="text">Enter text</label>
<textarea id="text">Tere tulemast!</textarea>

<div>
  <label>Speaker: <input id="speaker" value="mari"></label>
</div>

<button id="speak">Speak</button>
<p id="status"></p>
<audio id="player" controls></audio>

<script>
const status = document.getElementById('status');
const player = document.getElementById('player');
const validSpeakers = ["mari","taavi","anna","martin"];
// Update this URL to your deployed Vercel proxy
const proxyURL = "https://YOUR_VERCEL_URL/api/tts";

async function callTTS(text, speaker) {
  const resp = await fetch(proxyURL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ text, speaker, speed: 1 })
  });

  if (!resp.ok) {
    throw new Error(await resp.text());
  }

  return await resp.blob();
}

document.getElementById('speak').addEventListener('click', async () => {
  status.textContent = "Working...";
  player.src = "";

  try {
    let text = document.getElementById('text').value.trim();
    let speaker = document.getElementById('speaker').value.trim();

    if (!validSpeakers.includes(speaker)) {
      status.textContent = "Invalid speaker, using default 'mari'";
      speaker = "mari";
    }

    if (!text) throw new Error("Please enter text");
    text = text.substring(0, 200); // truncate text

    const audioBlob = await callTTS(text, speaker);
    const url = URL.createObjectURL(audioBlob);
    player.src = url;
    player.play();

    status.textContent = "Playing audio...";
  } catch (err) {
    console.error(err);
    status.textContent = "Error: " + err.message;
  }
});
</script>
</body>
</html>
